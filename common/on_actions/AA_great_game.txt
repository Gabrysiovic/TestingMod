###Created by Akiko, finished as of 5.01.26
##This is a bunch of shit to make Great Game work without having to touch the vanilla je's
##DISCLAIMER: because AI is motivated by giving them JE's this will cause errors, but that's unavoidable and harmless
#############
# Geat Game #
#############
#Gives control and starting je's on start, don't touch
on_game_started = {
	on_actions = {
		give_je_gg_control
		give_je_gg_BIC_annex
		give_je_gg_caucasus
		give_je_gg_PER_border
		give_je_gg_AFG_unify
		give_je_gg_sovereignty
	}
}

#Checks every month to add new ones
on_monthly_pulse_country = {
	on_actions = {
		AA_great_game
	}
}

#A bunch of on_actions meant to mimic the objective subgoals that hand out je's
#if any break just go to 02_subgoals_player_objectives_great_game.txt and copy stuff inside the trigger
AA_great_game = {
	on_actions = {
		give_je_gg_AFG_protect
		give_je_gg_AFG_annex
		give_je_gg_pacific
		give_je_gg_pamir
		give_je_gg_KZH_border
		give_je_gg_KZH_annex
		give_je_gg_CHI_border
		give_je_gg_CHI_annex
		give_je_gg_KOR_protect
		give_je_gg_PER_protect
		give_je_gg_PER_unify
		give_je_gg_TIB
	}
}

#je's given on game start have to be through effect->every_country, else they don't work due to lack of country scope
give_je_gg_control = {
	effect = {
		every_country = {
			if = {
				limit = {
					OR = {
						c:GBR ?= this
						c:RUS ?= this
						c:PER ?= this
						is_afghan_nation = yes
					}
					NOT = {
						has_global_variable = great_game_failed
					}
				}
				add_journal_entry = {
					type = je_great_game_control
				}
			}
		}
	}
}

#The rest are just mostly copy pasted from the subgoals
give_je_gg_AFG_protect = {
	trigger = {
		NOT = {
			has_global_variable = gg_afghanistan_protectorate_done
			has_variable = gg_AFG_protect_given
		}
		has_interest_marker_in_region = region_persia
		OR = {
			c:GBR ?= THIS
			c:RUS ?= THIS
		}
		has_journal_entry = je_great_game_control
	}
	effect = {
		add_journal_entry = {
			type = je_maintain_afghan_protectorate
		}
		set_variable = gg_AFG_protect_given
	}
}

give_je_gg_AFG_annex = {
	trigger = {
		has_interest_marker_in_region = region_persia
		OR = {
			c:GBR ?= THIS
			c:RUS ?= THIS
		}
		has_journal_entry = je_great_game_control
		exists = c:AFG
		NOT = {
			has_variable = gg_AFG_annex_given
		}
	}
	effect = {
		add_journal_entry = {
			type = je_consolidate_afghanistan_objective
		}
		set_variable = gg_AFG_annex_given
	}
}

give_je_gg_AFG_unify = {
	effect = {
		every_country = {
			if = {
				limit = {
					is_afghan_nation = yes
					has_journal_entry = je_great_game_control
				}
				add_journal_entry = {
					type = je_unify_afghanistan_objective
				}
			}
		}
	}
}

give_je_gg_caucasus = {
	effect = {
		every_country = {
			if = {
				limit = {
					c:GBR ?= THIS
					exists = c:CIR
					has_journal_entry = je_great_game_control
				}
				add_journal_entry = {
					type = je_disrupt_russian_caucasus
				}
			}
		}
	}
}

give_je_gg_pacific = {
	trigger = {
		c:GBR ?= THIS
		c:RUS ?= {
			any_scope_state = {
				region = sr:region_manchuria
				OR = {
					any_scope_building = {
						is_building_type = building_port
						level >= 5
					}
					any_scope_building = {
						is_building_type = building_naval_base
						level >= 15
					}
				}
			}
		}
		has_journal_entry = je_great_game_control
		NOT = {
			has_variable = gg_pacific_given
		}
	}
	effect = {
		add_journal_entry = {
			type = je_counter_russian_pacific_influence
		}
		set_variable = gg_pacific_given
	}
}

give_je_gg_BIC_annex = {
	effect = {
		every_country = {
			if = {
				limit = {
					c:GBR ?= THIS
					c:BIC ?= {
						is_subject_of = c:GBR
					}
					has_journal_entry = je_great_game_control
				}
				add_journal_entry = {
					type = je_consolidate_british_india
				}
			}
		}
	}
}

give_je_gg_pamir = {
	trigger = {
		c:GBR ?= THIS
		c:RUS ?= {
			OR = {
				any_scope_state = {
					state_region = s:STATE_TAJIKISTAN
				}
				any_subject_or_below = {
					any_scope_state = {
						state_region = s:STATE_TAJIKISTAN
					}
				}
			}
		}
		has_journal_entry = je_great_game_control
		NOT = {
			has_variable = dismissed_pamir_expedition
			has_variable = gg_pamir_given
		}
	}
	effect = {
		add_journal_entry = {
			type = je_pamir_expedition_objective
		}
		set_variable = gg_pamir_given
	}
}

give_je_gg_PER_border = {
	effect = {
		every_country = {
			if = {
				limit = {
					c:RUS ?= THIS
					exists = c:CIR
					has_journal_entry = je_great_game_control
				}
				add_journal_entry = {
					type = je_secure_persian_border
				}
			}
		}
	}
}

give_je_gg_KZH_border = {
	trigger = {
		c:RUS ?= THIS
		has_journal_entry = je_pacify_the_steppes
		has_journal_entry = je_great_game_control
		NOT = {
			has_variable = gg_KZH_border_given
		}
	}
	effect = {
		add_journal_entry = {
			type = je_pacify_kazakh_steppes
		}
		set_variable = gg_KZH_border_given
	}
}

give_je_gg_KZH_annex = {
	trigger = {
		c:RUS ?= THIS
		has_technology_researched = nationalism
		has_journal_entry = je_great_game_control
		NOT = {
			has_variable = gg_KZH_annex_given
		}
	}
	effect = {
		add_journal_entry = {
			type = je_consolidate_central_asia
		}
		set_variable = gg_KZH_annex_given
	}
}

give_je_gg_CHI_border = {
	trigger = {
		c:RUS ?= THIS
		has_technology_researched = nationalism
		has_journal_entry = je_great_game_control
		NOT = {
			has_variable = gg_CHI_border_given
		}
	}
	effect = {
		add_journal_entry = {
			type = je_codify_chinese_border
		}
		set_variable = gg_CHI_border_given
	}
}

give_je_gg_CHI_annex = {
	trigger = {
		c:RUS ?= THIS
		has_technology_researched = railways
		any_scope_state = {
			OR = {
				state_region = s:STATE_OUTER_MANCHURIA
				state_region = s:STATE_AMUR
			}
			is_incorporated = yes
		}
		has_journal_entry = je_great_game_control
		NOT = {
			has_variable = gg_CHI_annex_given
		}
	}
	effect = {
		add_journal_entry = {
			type = je_chinese_concessions
		}
		set_variable = gg_CHI_annex_given
	}
}

give_je_gg_KOR_protect = {
	trigger = {
		c:RUS ?= THIS
		any_neighbouring_state = {
			owner = c:KOR
			is_incorporated = yes
		}
		c:KOR ?= {
			is_country_type = unrecognized
		}
		has_journal_entry = je_great_game_control
		NOT = {
			has_variable = gg_KOR_protect_given
		}
	}
	effect = {
		set_global_variable = korean_protectorate_started
		add_journal_entry = {
			type = je_acquire_korean_protectorate
		}
		set_variable = gg_KOR_protect_given
	}
}

give_je_gg_PER_protect = {
	trigger = {
		has_interest_marker_in_region = region_persia
		OR = {
			c:GBR ?= THIS
			c:RUS ?= THIS
		}
		has_journal_entry = je_great_game_control
		NOT = {
			has_variable = gg_PER_protect_given
		}
	}
	effect = {
		add_journal_entry = {
			type = je_secure_influence_over_persia
		}
		set_variable = gg_PER_protect_given
	}
}

give_je_gg_PER_unify = {
	trigger = {
		c:PER ?= this
		has_journal_entry = je_great_game_control
		NOT = {
			has_variable = gg_PER_unify_given
		}
	}
	effect = {
		add_journal_entry = {
			type = je_consolidate_persia
		}
		set_variable = gg_PER_unify_given
	}
}

give_je_gg_sovereignty = {
	effect = {
		every_country = {
			if = {
				limit = {
					OR = {
						c:PER ?= this
						is_afghan_nation = yes
					}
					is_country_type = unrecognized
					has_journal_entry = je_great_game_control
				}
				add_journal_entry = {
					type = je_achieve_sovereignty
				}
			}
		}
	}
}

give_je_gg_TIB = {
	trigger = {
		NOT = {
			c:TIB ?= THIS
		}
		exists = c:TIB
		country_rank >= rank_value:great_power
		OR = {
			is_country_type = recognized
			is_country_type = colonial
		}
		has_variable = tibet_has_started
		NOT = {
			has_global_variable = tibet_expedition_completed
			has_variable = gg_TIB_given
		}
		has_interest_marker_in_region = region_himalayas
		has_journal_entry = je_great_game_control
	}
	effect = {
		add_journal_entry = {
			type = je_tibet_expedition
		}
		set_variable = gg_TIB_given
	}
}
